<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Expense Tracker</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>Expense Tracker</h1>

    <form id="expense-form">
      <input type="datetime-local" id="date" required />

    <select id="category" required>
        <option value="">--Select Category--</option>
    </select>


      <input type="number" id="amount" step="0.01" min="0" placeholder="Enter amount" required />

      <button type="submit">Add Expense</button>
      <button type="button" onclick="exportData()">Export Backup (.json)</button>

      <input type="file" id="import-file" accept=".json" style="display:none" onchange="importData(event)" />
      <button type="button" onclick="document.getElementById('import-file').click()">Import Backup (.json)</button>

      <button id="reset-btn" type="button" onclick="resetAllData()">Reset All Data</button>

      <div class="action-buttons">
        <button type="button" onclick="undoLastEntry()">Undo Last Entry</button>
        <button type="button" onclick="redoLastEntry()">Redo Last Entry</button>
      </div>
    </form>

    <!-- üîß Manage Categories Section -->
    <hr class="section-divider" />
    <h2>Manage Categories</h2>

    <form id="category-form" style="display: flex; flex-wrap: wrap; gap: 10px; align-items: center; margin-bottom: 15px;">
      <input type="text" id="new-type-name" placeholder="New Type Name" required style="flex: 2; padding: 5px;" />
      <select id="new-type-kind" style="flex: 1; padding: 5px;">
        <option value="Variable">Variable</option>
        <option value="Fixed">Fixed</option>
      </select>
      <input type="number" id="new-type-limit" placeholder="Limit ($)" step="0.01" required style="flex: 1; padding: 5px;" />
      <button type="submit" style="padding: 5px 10px;">‚ûï Add Type</button>
    </form>

    <h2>Remaining Budget</h2>

    <div id="month-year-toggle">
      <div class="toggle-group">
        <label for="month-select">Month:</label>
        <select id="month-select">
          <option value="0">January</option>
          <option value="1">February</option>
          <option value="2">March</option>
          <option value="3">April</option>
          <option value="4">May</option>
          <option value="5">June</option>
          <option value="6">July</option>
          <option value="7">August</option>
          <option value="8">September</option>
          <option value="9">October</option>
          <option value="10">November</option>
          <option value="11">December</option>
        </select>
      </div>

      <div class="toggle-group">
        <label for="year-select">Year:</label>
        <select id="year-select"></select>
      </div>
    </div>

    <div class="table-wrapper">
      <table id="budget-table">
        <thead>
          <tr>
            <th>Type</th>
            <th>Spent ($)</th>
            <th>Remaining ($)</th>
            <th>% Used</th>
            <th>Usage vs Allocated</th>
          </tr>
        </thead>
        <tbody id="budget-body"></tbody>
      </table>
    </div>

    <!-- üîµ Total Summary (Separate from Table but within Budget Section) -->
    <div id="total-summary" class="total-summary-box"></div>

    <!-- <div style="text-align: center; margin-top: 15px;">
      <button onclick="showPastBudgetSnapshots()" style="font-weight: bold;">üìÅ View Past Budget Summaries</button>
    </div>

    <div id="snapshot-view"></div> -->

    <hr class="section-divider" />
    <h2>History</h2>
    <div id="history-filter-bar" style="text-align: center; margin-bottom: 10px;">
      <label for="history-date-select" style="font-weight: bold;">Select Date:</label>
      <select id="history-date-select"></select>
    </div>
    <div id="history-view" class="history-container"></div>
  </div>

<!-- üîß Modal Popup for Editing Category -->
<!-- üîß Modal Popup for Editing Category -->
<div id="edit-category-modal" style="display: none; position: fixed; top: 20%; left: 50%; transform: translate(-50%, 0); background: #fff; border: 2px solid #ccc; padding: 20px; border-radius: 8px; z-index: 1000; width: 300px;">

  <!-- ‚úÖ Done Button (top-right) -->
  <button type="button" id="done-edit-button" style="position: absolute; top: 8px; right: 8px; font-size: 12px; padding: 2px 6px;">‚úÖ Done</button>

  <h3>Edit Category</h3>
  <form id="edit-category-form">
    <label>
      New Name:
      <input type="text" id="edit-type-name" />
    </label>
    <br><br>
    <label>
      New Limit ($):
      <input type="number" id="edit-type-limit" step="0.01" />
    </label>
    <br><br>
    <button type="submit">‚úÖ Apply</button>
    <button type="button" onclick="closeCategoryEditModal()">‚ùå Cancel</button>
  </form>
</div>


<!-- ‚úÖ Confirm Add Type Modal -->
<div id="confirm-add-type-modal" style="display: none; position: fixed; top: 25%; left: 50%; transform: translate(-50%, -25%); background: #fff; border: 2px solid #ccc; padding: 20px; border-radius: 10px; z-index: 1000; width: 320px;">
  <h3>Confirm New Category</h3>
  <p id="confirm-type-details"></p>
  <div style="text-align: right; margin-top: 10px;">
    <button id="confirm-add-type-btn" style="margin-right: 8px;">‚úÖ Yes, Add</button>
    <button onclick="closeConfirmAddTypeModal()">‚ùå Edit Again</button>
  </div>
</div>

<!-- üîí Confirm Editing Fixed Type -->
<div id="confirm-edit-fixed-modal" style="display: none; position: fixed; top: 30%; left: 50%; transform: translate(-50%, -30%); background: #fff; border: 2px solid #ccc; padding: 20px; border-radius: 10px; z-index: 1000; width: 320px;">
  <p>Are you sure you want to edit this <b>fixed</b> type?</p>
  <div style="text-align: right; margin-top: 10px;">
    <button id="confirm-edit-fixed-btn" style="margin-right: 8px;">‚úÖ Yes, Edit</button>
    <button onclick="closeFixedEditConfirmModal()">‚ùå Cancel</button>
  </div>
</div>



  <!-- ‚úÖ Local JS script (no Firebase, no type="module") -->
  <script src="script.js"></script>
</body>
</html>
